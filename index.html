<!DOCTYPE html>
<html lang="hy">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üéÇ ’ç’∏’Ω’´ ’ø’°÷Ä’•’§’°÷Ä’± üéÇ</title>

  <link rel="icon" type="image/x-icon" href="images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
  <link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="192x192" href="images/favicon-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="images/favicon-512x512.png">
  <meta name="theme-color" content="#333333">
  
  <style>
    html, body {
      margin: 0;
      font-family: "Comic Sans MS", cursive, sans-serif;
      background: url("images/background.jpg") no-repeat center center fixed;
      background-size: cover;
      text-align: center;
      color: #333;
      height: 100%;
      overflow-y: auto;
      overflow-x: hidden;
    }

    .card {
      margin: 30px auto;
      background: rgba(102, 102, 102, 0.3);
      border-radius: 20px;
      padding: 30px;
      width: 100%;
      max-width: 500px;
      box-shadow: 0 0 25px rgba(0,0,0,0.3);
      box-sizing: border-box;
      animation: slideUp 1s ease-out;
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(50px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h1 { color: #dbdbdb; font-size: 2em; }
    h3 { color: #fffff0; font-size: 1.3em; }

    input, select, button {
      font-family: inherit;
    }

    input {
      width: 88%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 10px;
      border: 1px solid #ccc;
      font-size: 16px;
      background: rgba(255, 255, 255, 0.5);
    }

    select {
      width: 93%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 10px;
      border: 1px solid #ccc;
      font-size: 16px;
      background: rgba(255, 255, 255, 0.5);
   }

    button {
      width: 70%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 10px;
      font-size: 16px;
      background: rgba(0, 0, 0, 0.9);
      color: #fff;
      border: none;
      cursor: pointer;
      font-weight: bold;
      transition: 0.3s;
    }

    button:hover { background: rgba(124, 124, 124, 0.9); }

    ::placeholder { color: #000; }

    .popup {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      z-index: 999;
      justify-content: center;
      align-items: center;
    }
    
    .popup-content {
      background: #fff;
      padding: 20px 30px;
      border-radius: 15px;
      text-align: center;
      max-width: 360px;
      width: 88%;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
      animation: popIn 0.3s ease;
      display: flex;
      flex-direction: column;
      gap: 12px;
      align-items: center;
    }
    
    @keyframes popIn {
      from { transform: scale(0.7); opacity: 0; }
      to   { transform: scale(1); opacity: 1; }
    }
    
    .popup-content p {
      font-size: 1.05em;
      margin: 0;
      word-break: keep-all;
    }
    
    .popup-content .popup-close-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      background: #333;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
      width: 140px;
    }
    
    .popup-content .popup-close-btn:hover {
      background: #666;
    }

    .popup.fade-out {
      animation: fadeOut 0.5s forwards;
    }
    
    @keyframes fadeOut {
      from { opacity: 1; }
      to   { opacity: 0; }
    }

    #countdown {
      font-size: 1.3em;
      color: #fff;
      margin: 20px 0;
    }

    #music-btn {
      display: none;
    }

    #confetti-canvas {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 2000;
    }

    /* Calendar buttons inside popup */
    #calendar-section {
      display: none; /* –±—É–¥–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ */
      width: 100%;
      display: flex;
      justify-content: center;
      gap: 8px;
      flex-wrap: wrap;
    }
    #calendar-section a {
      color: #fff;
      background: #333;
      padding: 8px 12px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: bold;
      display: inline-block;
    }
    #google-calendar-link {
      background: #4285F4;
    }
  </style>
</head>
<body>
  <audio id="bg-music" loop>
    <source src="music/happy_birthday.mp3" type="audio/mpeg">
  </audio>
  <button id="music-btn">üîä ’ä’°÷Ä’•’û’∂÷Ñ</button>

  <canvas id="confetti-canvas"></canvas>

  <div id="popup" class="popup" aria-hidden="true">
    <div class="popup-content" role="dialog" aria-modal="true" aria-labelledby="popup-message">
      <!-- –ö–Ω–æ–ø–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä—å ‚Äî —Ç–µ–ø–µ—Ä—å –≤–Ω—É—Ç—Ä–∏ popup –∏ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã –Ω–∞–¥ –∫–Ω–æ–ø–∫–æ–π –∑–∞–∫—Ä—ã—Ç–∏—è -->
      <div id="calendar-section" aria-hidden="true" style="display:none;">
        <a id="calendar-link" href="#" download="Sosi_birthday.ics">üìÖ ‘±’æ’•’¨’°÷Å’∂’•’¨ ÷Ö÷Ä’°÷Å’∏÷Ç’µ÷Å’´’∂</a>
        <a id="google-calendar-link" href="#" target="_blank">üåê ‘≤’°÷Å’∂’•’¨ Google ÷Ö÷Ä’°÷Å’∏÷Ç’µ÷Å’∏’æ</a>
      </div>

      <p id="popup-message"></p>

      <button class="popup-close-btn" onclick="closePopup()">’ì’°’Ø’•’¨</button>
    </div>
  </div>

  <div class="card" id="main-card">
    <h1>’Ñ’•’∂÷Ñ ’∑’∏÷Ç’ø’∏’æ 5 ’ø’°÷Ä’•’Ø’°’∂ ’•’∂÷Ñ</h1>
    <p style="color: #fffff0; font-size: 1.2em;">’ç’´÷Ä’∏’æ ’∞÷Ä’°’æ’´÷Ä’∏÷Ç’¥ ’•’∂÷Ñ ’±’•’¶` <br>’¥’°’Ω’∂’°’Ø÷Å’•’¨’∏÷Ç <b>’ç’∏’Ω’´</b> ’Æ’∂’∂’§’µ’°’∂ ÷á ’¥’°’ø’°’≤’´ ’°÷Ä’°÷Ä’∏’≤’∏÷Ç’©’µ’°’∂’® ÷á ’¥’•’¶ ’∞’•’ø ’Ø’´’Ω’•’¨’∏÷Ç ’°’µ’§ ’Ø’°÷Ä÷á’∏÷Ä ’∏÷Ç ’∞’´’∑’°÷Ä’™’°’∂ ÷Ö÷Ä’®</p>
    <p style="color: #fffff0; font-size: 1.2em;">’ç’´÷Ä’∏’æ ’Ø’Ω’∫’°’Ω’•’∂÷Ñ ’±’•’¶’ù <br><span style="text-align: center;"><b>üìÖ 27 ’Ü’∏’µ’•’¥’¢’•÷Ä’´ 2025<br>üìç ‘ø’´’¨’´’Ø’´’∏ ’£’°÷Ä’§’•’∂ <br>üïï ‘∫’°’¥’® 18:00</span></b></p>
    <p id="countdown"></p>
    <p><a href="https://yandex.com/maps/-/CLBII2kZ" style="color: #fffff0; font-size: 1.2em;"><b>‘ª’∂’π’∫’•’û’Ω ’∞’°’Ω’∂’•’¨</b></a></p>
    <h3 style="font-style: normal;">‘Ω’∂’§÷Ä’∏÷Ç’¥ ’•’∂÷Ñ ’∞’°’Ω’ø’°’ø’•’¨ ’±’•÷Ä ’∞÷Ä’°’æ’•÷Ä’® ’Ω’ø’∏÷Ä÷á</h3>
    <form id="rsvpForm">
      <input type="text" id="name" placeholder="‘±’∂’∏÷Ç’∂ ’°’¶’£’°’∂’∏÷Ç’∂ *"><br>
      <input type="tel" id="phone" placeholder="’Ä’•’º’°’≠’∏’Ω’°’∞’°’¥’°÷Ä * (0XXYYYYYY)" inputmode="tel"><br>
      <input type="number" id="count" placeholder="‘±’∂’±’°’∂÷Å ÷Ñ’°’∂’°’Ø *" inputmode="numeric" min="1"><br>
      <select id="status">
        <option value="" disabled selected hidden>‘∏’∂’ø÷Ä’•’¨ *</option>
        <option value="‘±’µ’∏">’Ñ’•’Æ ’Ω’´÷Ä’∏’æ</option>
        <option value="’à’π">’ë’°’æ’∏÷Ñ ’∏’π</option>
      </select><br>
      <button type="submit">’Ä’°’Ω’ø’°’ø’•’¨</button>
    </form>

    <p id="response"></p>
  </div>

  <script>
  const music = document.getElementById("bg-music");

  function tryPlayMusic() {
    music.play().catch(() => {});
  }
  ["click", "touchstart", "input", "scroll"].forEach(evt => {
    window.addEventListener(evt, tryPlayMusic, { once: true });
  });
  window.addEventListener("load", () => {
    setTimeout(() => {
      music.play().catch(() => {});
    }, 800);
  });

  let secretClicks = 0;
  document.getElementById("main-card").addEventListener("click", () => {
    secretClicks++;
    if (secretClicks === 5) {
      showPopup("üéâ ’ç’∏’Ω’® ’¥’•’Æ ’Ω’´÷Ä’∏’æ ’Ω’∫’°’Ω’∏÷Ç’¥ ’ß ’±’•’¶ üéâ");
      secretClicks = 0;
    }
    setTimeout(() => secretClicks = 0, 2000);
  });

  function startCountdown() {
    const targetDate = new Date("2025-11-27T18:00:00");
    const countdownEl = document.getElementById("countdown");

    function updateCountdown() {
      const now = new Date();
      const diff = targetDate - now;

      if (diff <= 0) {
        countdownEl.innerHTML = "üéâ ’è’∏’∂’°’Ø’°’ø’°÷Ä’∏÷Ç’©’µ’∏÷Ç’∂’® ’Ω’Ø’Ω’æ’•’¨ ’ß üéâ";
        return;
      }

      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
      const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
      const minutes = Math.floor((diff / (1000 * 60)) % 60);
      const seconds = Math.floor((diff / 1000) % 60);

      countdownEl.innerHTML = `’Ñ’∂’°÷Å’•’¨ ’ß’ù <b>${days}</b> ÷Ö÷Ä <b>${hours}</b> ’™’°’¥ <b>${minutes}</b> ÷Ä’∏’∫’• <b>${seconds}</b> ’æ’°’µ÷Ä’Ø’µ’°’∂`;
    }

    updateCountdown();
    setInterval(updateCountdown, 1000);
  }
  startCountdown();

document.getElementById("rsvpForm").addEventListener("submit", function(e){
  e.preventDefault();

  const name = document.getElementById("name").value.trim();
  let phone = document.getElementById("phone").value.trim();
  const count = document.getElementById("count").value.trim();
  const status = document.getElementById("status").value;

  if (!name || !phone || !count || !status) {
    showPopup("‘Ω’∂’§÷Ä’∏÷Ç’¥ ’•’∂÷Ñ ’¨÷Ä’°÷Å’∂’•’¨ ’¢’∏’¨’∏÷Ä ’∫’°÷Ä’ø’°’§’´÷Ä ’∂’∑’æ’°’Æ ’§’°’∑’ø’•÷Ä’®÷â");
    return;
  }

  phone = phone.replace(/\D/g, "");
  if (phone.startsWith("0")) phone = "374" + phone.slice(1);
  if (phone.startsWith("3740")) phone = "374" + phone.slice(4);

  const sheetAPI = "https://sheetdb.io/api/v1/73phymm5nctlc";

  fetch(`${sheetAPI}/search?phone=${encodeURIComponent(phone)}`)
    .then(res => res.json())
    .then(data => {
      if (Array.isArray(data) && data.length > 0) {
        showPopup(`’Ä’°÷Ä’£’•’¨’´ <b>${name}</b>, ’±’•÷Ä ’∞÷Ä’°’æ’•÷Ä’∂ ’°÷Ä’§’•’∂ ’∞’°’Ω’ø’°’ø’æ’°’Æ ’ß÷â ’ç’´÷Ä’∏’æ ’Ø’Ω’∫’°’Ω’•’∂÷Ñ ’±’•’¶÷â`);
        document.getElementById("rsvpForm").reset();
        return;
      }

      return fetch(sheetAPI, {
        method: "POST",
        body: JSON.stringify({
          data: [{ name, phone, count, status }]
        }),
        headers: { "Content-Type": "application/json" }
      })
      .then(res => res.json())
      .then(() => {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º popup (–Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
        showPopup(`’Ä’°÷Ä’£’•’¨’´ <b>${name}</b>, ’§’∏÷Ç÷Ñ ’∞’°’ª’∏’≤’∏÷Ç’©’µ’°’¥’¢ ’£÷Ä’°’∂÷Å’æ’•÷Å’´÷Ñ`);
        celebrate();
        document.getElementById("rsvpForm").reset();

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è ICS –∏ Google Calendar —Å—Å—ã–ª–æ–∫ ‚Äî –ª–æ–≥–∏–∫–∞ –æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –∫–∞–∫ –µ—Å—Ç—å
        generateCalendarFile();

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –≤ popup (–æ–Ω–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤–≤–µ—Ä—Ö—É pop-up –º–µ–Ω—é, –Ω–∞–¥ –∫–Ω–æ–ø–∫–æ–π "’ì’°’Ø’•’¨")
        const calSection = document.getElementById("calendar-section");
        if (calSection) calSection.style.display = "flex";

        // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ popup –æ—Å—Ç–∞—ë—Ç—Å—è –≤–∏–¥–∏–º—ã–º (–Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
        // (–Ω–∏—á–µ–≥–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –Ω–µ –¥–µ–ª–∞–µ–º ‚Äî close –¥–µ–ª–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∫–Ω–æ–ø–∫–∞ "’ì’°’Ø’•’¨")
      });
    })
    .catch(() => {
      showPopup(`’Ä’°÷Ä’£’•’¨’´ <b>${name}</b>, ’£÷Ä’°’∂÷Å’æ’•’¨’∏÷Ç ’®’∂’©’°÷Å÷Ñ’∏÷Ç’¥ ’°’º’°’ª’°÷Å’•’¨ ’ß ’≠’∂’§’´÷Ä, ’≠’∂’§÷Ä’∏÷Ç’¥ ’•’∂÷Ñ ÷É’∏÷Ä’±’•÷Ñ ’Ø÷Ä’Ø’´’∂`);
    });
});

function generateCalendarFile() {
  const eventTitle = "üéÇ ’ç’∏’Ω’´ 5-÷Ä’§ ’ø’°÷Ä’•’§’°÷Ä’±’®";
  const eventDescription = "’ç’´÷Ä’∏’æ ’∞÷Ä’°’æ’´÷Ä’∏÷Ç’¥ ’•’∂÷Ñ ’¥’°’Ω’∂’°’Ø÷Å’•’¨’∏÷Ç ’ç’∏’Ω’´ ’Æ’∂’∂’§’µ’°’∂ ÷á ’¥’°’ø’°’≤’´ ’°÷Ä’°÷Ä’∏’≤’∏÷Ç’©’µ’°’∂’®÷â";
  const eventLocation = "‘ø’´’¨’´’Ø’´’∏ ’£’°÷Ä’§’•’∂";
  const startDate = new Date("2025-11-27T18:00:00+04:00");
  const endDate = new Date("2025-11-27T23:30:00+04:00");

  function formatDateToICS(date) {
    return date.toISOString().replace(/[-:]/g, "").split(".")[0] + "Z";
  }

  const icsContent = `
BEGIN:VCALENDAR
VERSION:2.0
CALSCALE:GREGORIAN
BEGIN:VEVENT
SUMMARY:${eventTitle}
DESCRIPTION:${eventDescription}
LOCATION:${eventLocation}
DTSTART:${formatDateToICS(startDate)}
DTEND:${formatDateToICS(endDate)}
END:VEVENT
END:VCALENDAR`;

  const blob = new Blob([icsContent], { type: "text/calendar" });
  const url = URL.createObjectURL(blob);
  document.getElementById("calendar-link").href = url;

  const start = encodeURIComponent(formatDateToICS(startDate));
  const end = encodeURIComponent(formatDateToICS(endDate));
  const googleLink = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(eventTitle)}&details=${encodeURIComponent(eventDescription)}&location=${encodeURIComponent(eventLocation)}&dates=${start}/${end}`;
  document.getElementById("google-calendar-link").href = googleLink;
}

function celebrate() {
  const canvas = document.getElementById("confetti-canvas");
  const ctx = canvas.getContext("2d");
  const confetti = [];

  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  const shapes = ["circle", "square", "triangle", "ribbon"];
  let opacity = 1.0;

  for (let i = 0; i < 180; i++) {
    confetti.push({
      x: Math.random() * canvas.width,
      y: Math.random() * -canvas.height,
      r: Math.random() * 6 + 4,
      d: Math.random() * 0.5 + 0.5,
      color: `hsl(${Math.random() * 360}, 100%, 60%)`,
      tilt: Math.random() * 10 - 5,
      tiltAngle: 0,
      tiltAngleIncrement: (Math.random() * 0.07) + 0.02,
      shape: shapes[Math.floor(Math.random() * shapes.length)],
      rotation: Math.random() * 360,
      rotationSpeed: Math.random() * 5 - 2.5,
    });
  }

  function drawConfetti(c) {
    ctx.save();
    ctx.translate(c.x, c.y);
    ctx.rotate((c.rotation * Math.PI) / 180);
    ctx.globalAlpha = opacity;
    ctx.fillStyle = c.color;

    switch (c.shape) {
      case "circle": ctx.beginPath(); ctx.arc(0, 0, c.r, 0, Math.PI * 2); ctx.fill(); break;
      case "square": ctx.fillRect(-c.r / 2, -c.r / 2, c.r, c.r); break;
      case "triangle":
        ctx.beginPath();
        ctx.moveTo(0, -c.r);
        ctx.lineTo(c.r, c.r);
        ctx.lineTo(-c.r, c.r);
        ctx.closePath();
        ctx.fill();
        break;
      case "ribbon":
        ctx.beginPath();
        ctx.ellipse(0, 0, c.r * 1.5, c.r / 3, 0, 0, Math.PI * 2);
        ctx.fill();
        break;
    }

    ctx.restore();
  }

  function updateConfetti() {
    for (const c of confetti) {
      c.y += c.d * 7;
      c.x += Math.sin(c.tiltAngle) * 2;
      c.tiltAngle += c.tiltAngleIncrement;
      c.rotation += c.rotationSpeed;
      if (c.y > canvas.height + 20) {
        c.y = -10;
        c.x = Math.random() * canvas.width;
      }
    }
  }

  let animationFrame;
  function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    confetti.forEach(drawConfetti);
    updateConfetti();
    animationFrame = requestAnimationFrame(animate);
  }

  animate();

  setTimeout(() => {
    const fade = setInterval(() => {
      opacity -= 0.05;
      if (opacity <= 0) {
        clearInterval(fade);
        cancelAnimationFrame(animationFrame);
        ctx.clearRect(0, 0, canvas.width, canvas.height);
      }
    }, 100);
  }, 7000);
}

window.addEventListener("beforeunload", () => {
  music.pause();
  music.currentTime = 0;
});
document.addEventListener("visibilitychange", () => {
  if (document.hidden) {
    music.pause();
    music.currentTime = 0;
  }
});

function showPopup(message) {
  const popup = document.getElementById("popup");
  document.getElementById("popup-message").innerHTML = message;
  popup.style.display = "flex";
  popup.setAttribute("aria-hidden", "false");
}
function closePopup() {
  const popup = document.getElementById("popup");
  popup.classList.add("fade-out");
  setTimeout(() => {
    popup.style.display = "none";
    popup.classList.remove("fade-out");
    popup.setAttribute("aria-hidden", "true");
  }, 500);
}
  </script>
</body>
</html>
